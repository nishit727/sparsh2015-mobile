(function(t,e){if(typeof define==="function"&&define.amd){define(["underscore","jquery","exports"],function(i,r,n){t.Backbone=t.Exoskeleton=e(t,n,i,r)})}else if(typeof exports!=="undefined"){var i,r;try{i=require("underscore")}catch(n){}try{r=require("jquery")}catch(n){}e(t,exports,i,r)}else{t.Backbone=t.Exoskeleton=e(t,{},t._,t.jQuery||t.Zepto||t.ender||t.$)}})(this,function(t,e,i,r){"use strict";var n=t.Backbone;var s=t.Exoskeleton;var a=e.utils=i=i||{};e.$=r;var o=[];var u=o.push;var h=o.slice;var c={}.toString;e.noConflict=function(){t.Backbone=n;t.Exoskeleton=s;return this};e.extend=function(t,e){var r=this;var n;if(t&&i.has(t,"constructor")){n=t.constructor}else{n=function(){return r.apply(this,arguments)}}i.extend(n,r,e);var s=function(){this.constructor=n};s.prototype=r.prototype;n.prototype=new s;if(t)i.extend(n.prototype,t);n.__super__=r.prototype;return n};var l=function(){throw new Error('A "url" property or function must be specified')};var f=function(t,e){var i=e.error;e.error=function(r){if(i)i(t,r,e);t.trigger("error",t,r,e)}};var d=function(t){return typeof i[t]==="function"};a.result=function J(t,e){var i=t?t[e]:undefined;return typeof i==="function"?t[e]():i};a.defaults=function V(t){h.call(arguments,1).forEach(function(e){for(var i in e)if(t[i]===undefined)t[i]=e[i]});return t};a.extend=function G(t){h.call(arguments,1).forEach(function(e){for(var i in e)t[i]=e[i]});return t};var p={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};a.escape=function D(t){return t==null?"":String(t).replace(/[&<>"']/g,function(t){return p[t]})};a.sortBy=function(t,e,i){var r=typeof e==="function"?e:function(t){return t[e]};return t.map(function(t,e,n){return{value:t,index:e,criteria:r.call(i,t,e,n)}}).sort(function(t,e){var i=t.criteria;var r=e.criteria;if(i!==r){if(i>r||i===void 0)return 1;if(i<r||r===void 0)return-1}return t.index-e.index}).map(function(t){return t.value})};var v=0;a.uniqueId=function Q(t){var e=++v+"";return t?t+e:e};a.has=function(t,e){return Object.hasOwnProperty.call(t,e)};var g=function(t,e,r,n){if(t===e)return t!==0||1/t==1/e;if(t==null||e==null)return t===e;var s=c.call(t);if(s!=c.call(e))return false;switch(s){case"[object String]":return t==String(e);case"[object Number]":return t!==+t?e!==+e:t===0?1/t===1/e:t===+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if(typeof t!="object"||typeof e!="object")return false;var a=r.length;while(a--){if(r[a]==t)return n[a]==e}var o=t.constructor,u=e.constructor;if(o!==u&&!(typeof o==="function"&&o instanceof o&&typeof u==="function"&&u instanceof u)){return false}r.push(t);n.push(e);var h=0,l=true;if(s==="[object Array]"){h=t.length;l=h===e.length;if(l){while(h--){if(!(l=g(t[h],e[h],r,n)))break}}}else{for(var f in t){if(i.has(t,f)){h++;if(!(l=i.has(e,f)&&g(t[f],e[f],r,n)))break}}if(l){for(f in e){if(i.has(e,f)&&!h--)break}l=!h}}r.pop();n.pop();return l};a.isEqual=function(t,e){return g(t,e,[],[])};var m=e.Events={on:function(t,e,i){if(!b(this,"on",t,[e,i])||!e)return this;this._events||(this._events={});var r=this._events[t]||(this._events[t]=[]);r.push({callback:e,context:i,ctx:i||this});return this},once:function(t,e,i){if(!b(this,"once",t,[e,i])||!e)return this;var r=this;var n;var s=function(){if(n)return;n=true;r.off(t,s);e.apply(this,arguments)};s._callback=e;return this.on(t,s,i)},off:function(t,e,i){var r,n,s,a,o,u,h,c;if(!this._events||!b(this,"off",t,[e,i]))return this;if(!t&&!e&&!i){this._events=void 0;return this}a=t?[t]:Object.keys(this._events);for(o=0,u=a.length;o<u;o++){t=a[o];if(s=this._events[t]){this._events[t]=r=[];if(e||i){for(h=0,c=s.length;h<c;h++){n=s[h];if(e&&e!==n.callback&&e!==n.callback._callback||i&&i!==n.context){r.push(n)}}}if(!r.length)delete this._events[t]}}return this},trigger:function(t){if(!this._events)return this;var e=h.call(arguments,1);if(!b(this,"trigger",t,e))return this;var i=this._events[t];var r=this._events.all;if(i)_(i,e);if(r)_(r,arguments);return this},stopListening:function(t,e,i){var r=this._listeningTo;if(!r)return this;var n=!e&&!i;if(!i&&typeof e==="object")i=this;if(t)(r={})[t._listenId]=t;for(var s in r){t=r[s];t.off(e,i,this);if(n||!Object.keys(t._events).length)delete this._listeningTo[s]}return this}};var y=/\s+/;var b=function(t,e,i,r){if(!i)return true;if(typeof i==="object"){for(var n in i){t[e].apply(t,[n,i[n]].concat(r))}return false}if(y.test(i)){var s=i.split(y);for(var a=0,o=s.length;a<o;a++){t[e].apply(t,[s[a]].concat(r))}return false}return true};var _=function(t,e){var i,r=-1,n=t.length,s=e[0],a=e[1],o=e[2];switch(e.length){case 0:while(++r<n)(i=t[r]).callback.call(i.ctx);return;case 1:while(++r<n)(i=t[r]).callback.call(i.ctx,s);return;case 2:while(++r<n)(i=t[r]).callback.call(i.ctx,s,a);return;case 3:while(++r<n)(i=t[r]).callback.call(i.ctx,s,a,o);return;default:while(++r<n)(i=t[r]).callback.apply(i.ctx,e);return}};var x={listenTo:"on",listenToOnce:"once"};Object.keys(x).forEach(function(t){var e=x[t];m[t]=function(t,r,n){var s=this._listeningTo||(this._listeningTo={});var a=t._listenId||(t._listenId=i.uniqueId("l"));s[a]=t;if(!n&&typeof r==="object")n=this;t[e](r,n,this);return this}});m.bind=m.on;m.unbind=m.off;i.extend(e,m);var w=e.Model=function(t,e){var r=t||{};e||(e={});this.cid=i.uniqueId("c");this.attributes=Object.create(null);if(e.collection)this.collection=e.collection;if(e.parse)r=this.parse(r,e)||{};r=i.defaults({},r,i.result(this,"defaults"));this.set(r,e);this.changed=Object.create(null);this.initialize.apply(this,arguments)};i.extend(w.prototype,m,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(t){return i.extend({},this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return i.escape(this.get(t))},has:function(t){return this.get(t)!=null},set:function(t,e,r){var n,s,a,o,u,h,c,l;if(t==null)return this;if(typeof t==="object"){s=t;r=e}else{(s={})[t]=e}r||(r={});if(!this._validate(s,r))return false;a=r.unset;u=r.silent;o=[];h=this._changing;this._changing=true;if(!h){this._previousAttributes=i.extend(Object.create(null),this.attributes);this.changed={}}l=this.attributes,c=this._previousAttributes;if(this.idAttribute in s)this.id=s[this.idAttribute];for(n in s){e=s[n];if(!i.isEqual(l[n],e))o.push(n);if(!i.isEqual(c[n],e)){this.changed[n]=e}else{delete this.changed[n]}a?delete l[n]:l[n]=e}if(!u){if(o.length)this._pending=r;for(var f=0,d=o.length;f<d;f++){this.trigger("change:"+o[f],this,l[o[f]],r)}}if(h)return this;if(!u){while(this._pending){r=this._pending;this._pending=false;this.trigger("change",this,r)}}this._pending=false;this._changing=false;return this},unset:function(t,e){return this.set(t,void 0,i.extend({},e,{unset:true}))},clear:function(t){var e={};for(var r in this.attributes)e[r]=void 0;return this.set(e,i.extend({},t,{unset:true}))},hasChanged:function(t){if(t==null)return!!Object.keys(this.changed).length;return i.has(this.changed,t)},changedAttributes:function(t){if(!t)return this.hasChanged()?i.extend(Object.create(null),this.changed):false;var e,r=false;var n=this._changing?this._previousAttributes:this.attributes;for(var s in t){if(i.isEqual(n[s],e=t[s]))continue;(r||(r={}))[s]=e}return r},previous:function(t){if(t==null||!this._previousAttributes)return null;return this._previousAttributes[t]},previousAttributes:function(){return i.extend(Object.create(null),this._previousAttributes)},fetch:function(t){t=t?i.extend({},t):{};if(t.parse===void 0)t.parse=true;var e=this;var r=t.success;t.success=function(i){if(!e.set(e.parse(i,t),t))return false;if(r)r(e,i,t);e.trigger("sync",e,i,t)};f(this,t);return this.sync("read",this,t)},save:function(t,e,r){var n,s,a,o=this.attributes;if(t==null||typeof t==="object"){n=t;r=e}else{(n={})[t]=e}r=i.extend({validate:true},r);if(n&&!r.wait){if(!this.set(n,r))return false}else{if(!this._validate(n,r))return false}if(n&&r.wait){this.attributes=i.extend(Object.create(null),o,n)}if(r.parse===void 0)r.parse=true;var u=this;var h=r.success;r.success=function(t){u.attributes=o;var e=u.parse(t,r);if(r.wait)e=i.extend(n||{},e);if(e&&typeof e==="object"&&!u.set(e,r)){return false}if(h)h(u,t,r);u.trigger("sync",u,t,r)};f(this,r);s=this.isNew()?"create":r.patch?"patch":"update";if(s==="patch")r.attrs=n;a=this.sync(s,this,r);if(n&&r.wait)this.attributes=o;return a},destroy:function(t){t=t?i.extend({},t):{};var e=this;var r=t.success;var n=function(){e.trigger("destroy",e,e.collection,t)};t.success=function(i){if(t.wait||e.isNew())n();if(r)r(e,i,t);if(!e.isNew())e.trigger("sync",e,i,t)};if(this.isNew()){t.success();return false}f(this,t);var s=this.sync("delete",this,t);if(!t.wait)n();return s},url:function(){var t=i.result(this,"urlRoot")||i.result(this.collection,"url")||l();if(this.isNew())return t;return t.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},i.extend(t||{},{validate:true}))},_validate:function(t,e){if(!e.validate||!this.validate)return true;t=i.extend(Object.create(null),this.attributes,t);var r=this.validationError=this.validate(t,e)||null;if(!r)return true;this.trigger("invalid",this,r,i.extend(e,{validationError:r}));return false}});if(i.keys){var E=["keys","values","pairs","invert","pick","omit"];E.filter(d).forEach(function(t){w.prototype[t]=function(){var e=h.call(arguments);e.unshift(this.attributes);return i[t].apply(i,e)}})}var k=e.Collection=function(t,e){e||(e={});if(e.model)this.model=e.model;if(e.comparator!==void 0)this.comparator=e.comparator;this._reset();this.initialize.apply(this,arguments);if(t)this.reset(t,i.extend({silent:true},e))};var j={add:true,remove:true,merge:true};var $={add:true,remove:false};i.extend(k.prototype,m,{model:typeof w==="undefined"?null:w,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return e.sync.apply(this,arguments)},add:function(t,e){return this.set(t,i.extend({merge:false},e,$))},remove:function(t,e){var i=!Array.isArray(t);t=i?[t]:t.slice();e||(e={});var r,n,s,a;for(r=0,n=t.length;r<n;r++){a=t[r]=this.get(t[r]);if(!a)continue;delete this._byId[a.id];delete this._byId[a.cid];s=this.indexOf(a);this.models.splice(s,1);this.length--;if(!e.silent){e.index=s;a.trigger("remove",a,this,e)}this._removeReference(a,e)}return i?t[0]:t},set:function(t,e){e=i.defaults({},e,j);if(e.parse)t=this.parse(t,e);var r=!Array.isArray(t);t=r?t?[t]:[]:t.slice();var n,s,a,o,u,h,c;var l=e.at;var f=this.model;var d=this.comparator&&l==null&&e.sort!==false;var p=typeof this.comparator==="string"?this.comparator:null;var v=[],g=[],m={};var y=e.add,b=e.merge,_=e.remove;var x=!d&&y&&_?[]:false;for(n=0,s=t.length;n<s;n++){u=t[n]||{};if(u instanceof w){a=o=u}else{a=u[f.prototype.idAttribute||"id"]}if(h=this.get(a)){if(_)m[h.cid]=true;if(b){u=u===o?o.attributes:u;if(e.parse)u=h.parse(u,e);h.set(u,e);if(d&&!c&&h.hasChanged(p))c=true}t[n]=h}else if(y){o=t[n]=this._prepareModel(u,e);if(!o)continue;v.push(o);this._addReference(o,e)}o=h||o;if(x&&(o.isNew()||!m[o.id]))x.push(o);m[o.id]=true}if(_){for(n=0,s=this.length;n<s;++n){if(!m[(o=this.models[n]).cid])g.push(o)}if(g.length)this.remove(g,e)}if(v.length||x&&x.length){if(d)c=true;this.length+=v.length;if(l!=null){for(n=0,s=v.length;n<s;n++){this.models.splice(l+n,0,v[n])}}else{if(x)this.models.length=0;var E=x||v;for(n=0,s=E.length;n<s;n++){this.models.push(E[n])}}}if(c)this.sort({silent:true});if(!e.silent){for(n=0,s=v.length;n<s;n++){(o=v[n]).trigger("add",o,this,e)}if(c||x&&x.length)this.trigger("sort",this,e)}return r?t[0]:t},reset:function(t,e){e||(e={});for(var r=0,n=this.models.length;r<n;r++){this._removeReference(this.models[r],e)}e.previousModels=this.models;this._reset();t=this.add(t,i.extend({silent:true},e));if(!e.silent)this.trigger("reset",this,e);return t},push:function(t,e){return this.add(t,i.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);this.remove(e,t);return e},unshift:function(t,e){return this.add(t,i.extend({at:0},e))},shift:function(t){var e=this.at(0);this.remove(e,t);return e},slice:function(){return h.apply(this.models,arguments)},get:function(t){if(t==null)return void 0;return this._byId[t]||this._byId[t.id]||this._byId[t.cid]},at:function(t){return this.models[t]},where:function(t,e){if(!t||!Object.keys(t).length)return e?void 0:[];return this[e?"find":"filter"](function(e){for(var i in t){if(t[i]!==e.get(i))return false}return true})},findWhere:function(t){return this.where(t,true)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");t||(t={});if(typeof this.comparator==="string"||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(this.comparator.bind(this))}if(!t.silent)this.trigger("sort",this,t);return this},pluck:function(t){return this.models.map(function(e){return e.get(t)})},fetch:function(t){t=t?i.extend({},t):{};if(t.parse===void 0)t.parse=true;var e=t.success;var r=this;t.success=function(i){var n=t.reset?"reset":"set";r[n](i,t);if(e)e(r,i,t);r.trigger("sync",r,i,t)};f(this,t);return this.sync("read",this,t)},create:function(t,e){e=e?i.extend({},e):{};if(!(t=this._prepareModel(t,e)))return false;if(!e.wait)this.add(t,e);var r=this;var n=e.success;e.success=function(t,i){if(e.wait)r.add(t,e);if(n)n(t,i,e)};t.save(null,e);return t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId=Object.create(null)},_prepareModel:function(t,e){if(t instanceof w)return t;e=i.extend({},e);e.collection=this;var r=new this.model(t,e);if(!r.validationError)return r;this.trigger("invalid",this,r.validationError,e);return false},_addReference:function(t,e){this._byId[t.cid]=t;if(t.id!=null)this._byId[t.id]=t;if(!t.collection)t.collection=this;t.on("all",this._onModelEvent,this)},_removeReference:function(t,e){if(this===t.collection)delete t.collection;t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,r){if((t==="add"||t==="remove")&&i!==this)return;if(t==="destroy")this.remove(e,r);if(e&&t==="change:"+e.idAttribute){delete this._byId[e.previous(e.idAttribute)];if(e.id!=null)this._byId[e.id]=e}this.trigger.apply(this,arguments)}});if(d("each")){var O=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"];O.filter(d).forEach(function(t){k.prototype[t]=function(){var e=h.call(arguments);e.unshift(this.models);return i[t].apply(i,e)}});var A=["groupBy","countBy","sortBy"];A.filter(d).forEach(function(t){k.prototype[t]=function(e,r){var n=typeof e==="function"?e:function(t){return t.get(e)};return i[t](this.models,n,r)}})}else{["forEach","map","filter","some","every","reduce","reduceRight","indexOf","lastIndexOf"].forEach(function(t){k.prototype[t]=function(e,i){return this.models[t](e,i)}});k.prototype.find=function(t,e){var i;this.some(function(r,n,s){if(t.call(e,r,n,s)){i=r;return true}});return i};["sortBy"].forEach(function(t){k.prototype[t]=function(e,r){var n=typeof e==="function"?e:function(t){return t.get(e)};return i[t](this.models,n,r)}})}var I=e.View=function(t){this.cid=i.uniqueId("view");if(t)Object.keys(t).forEach(function(e){if(N.indexOf(e)!==-1)this[e]=t[e]},this);this._ensureElement();this.initialize.apply(this,arguments)};var R=/^(\S+)\s*(.*)$/;var N=["model","collection","el","id","attributes","className","tagName","events"];i.extend(I.prototype,m,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){this._removeElement();this.stopListening();return this},_removeElement:function(){this.$el.remove()},setElement:function(t){this.undelegateEvents();this._setElement(t);this.delegateEvents();return this},_setElement:function(t){if(!e.$)throw new Error("You must either include jQuery or override Backbone.View.prototype methods (Google Backbone.NativeView)");this.$el=t instanceof e.$?t:e.$(t);this.el=this.$el[0]},delegateEvents:function(t){if(!(t||(t=i.result(this,"events"))))return this;this.undelegateEvents();for(var e in t){var r=t[e];if(typeof r!=="function")r=this[t[e]];var n=e.match(R);this.delegate(n[1],n[2],r.bind(this))}return this},delegate:function(t,e,i){this.$el.on(t+".delegateEvents"+this.cid,e,i)},undelegateEvents:function(){if(this.$el)this.$el.off(".delegateEvents"+this.cid);return this},undelegate:function(t,e,i){this.$el.off(t+".delegateEvents"+this.cid,e,i)},_createElement:function(t){return document.createElement(t)},_ensureElement:function(){if(!this.el){var t=i.extend({},i.result(this,"attributes"));if(this.id)t.id=i.result(this,"id");if(this.className)t["class"]=i.result(this,"className");this.setElement(this._createElement(i.result(this,"tagName")));this._setAttributes(t)}else{this.setElement(i.result(this,"el"))}},_setAttributes:function(t){this.$el.attr(t)}});e.sync=function(t,r,n){n||(n={});var s=S[t];var a={type:s,dataType:"json"};if(!n.url){a.url=i.result(r,"url")||l()}if(n.data==null&&r&&(t==="create"||t==="update"||t==="patch")){a.contentType="application/json";a.data=JSON.stringify(n.attrs||r.toJSON(n))}if(a.type!=="GET"){a.processData=false}var o=n.xhr=e.ajax(i.extend(a,n));r.trigger("request",r,o,n);return o};var S={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};e.ajax=function(){if(!e.$)throw new Error("You must either include jQuery or override Backbone.ajax (Google Backbone.NativeAjax)");return e.$.ajax.apply(e.$,arguments)};var C=e.Router=function(t){t||(t={});if(t.routes)this.routes=t.routes;this._bindRoutes();this.initialize.apply(this,arguments)};var B=/\((.*?)\)/g;var T=/(\(\?)?:\w+/g;var U=/\*\w+/g;var q=/[\-{}\[\]+?.,\\\^$|#\s]/g;var H=function(t){return t?typeof t==="object"&&c.call(t)==="[object RegExp]":false};i.extend(C.prototype,m,{initialize:function(){},route:function(t,i,r){if(!H(t))t=this._routeToRegExp(t);if(typeof i==="function"){r=i;i=""}if(!r)r=this[i];var n=this;e.history.route(t,function(s){var a=n._extractParameters(t,s);n.execute(r,a);n.trigger.apply(n,["route:"+i].concat(a));n.trigger("route",i,a);e.history.trigger("route",n,i,a)});return this},execute:function(t,e){if(t)t.apply(this,e)},navigate:function(t,i){e.history.navigate(t,i);return this},_bindRoutes:function(){if(!this.routes)return;this.routes=i.result(this,"routes");var t,e=Object.keys(this.routes);while((t=e.pop())!=null){this.route(t,this.routes[t])}},_routeToRegExp:function(t){t=t.replace(q,"\\$&").replace(B,"(?:$1)?").replace(T,function(t,e){return e?t:"([^/?]+)"}).replace(U,"([^?]*?)");return new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var i=t.exec(e).slice(1);return i.map(function(t,e){if(e===i.length-1)return t||null;return t?decodeURIComponent(t):null})}});var P=e.History=function(){this.handlers=[];this.checkUrl=this.checkUrl.bind(this);if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var z=/^[#\/]|\s+$/g;var M=/^\/+|\/+$/g;var L=/\/$/;var F=/[#].*$/;P.started=false;i.extend(P.prototype,m,{atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(t==null){if(this._wantsPushState||!this._wantsHashChange){t=decodeURI(this.location.pathname+this.location.search);var i=this.root.replace(L,"");if(!t.indexOf(i))t=t.slice(i.length)}else{t=this.getHash()}}return t.replace(z,"")},start:function(t){if(P.started)throw new Error("Backbone.history has already been started");P.started=true;this.options=i.extend({root:"/"},this.options,t);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;var e=this.getFragment();this.root=("/"+this.root+"/").replace(M,"/");if(this._wantsPushState){window.addEventListener("popstate",this.checkUrl,false)}else if(this._wantsHashChange){window.addEventListener("hashchange",this.checkUrl,false)}this.fragment=e;var r=this.location;if(this._wantsHashChange&&this._wantsPushState){if(this.atRoot()&&r.hash){this.fragment=this.getHash().replace(z,"");this.history.replaceState({},document.title,this.root+this.fragment)}}if(!this.options.silent)return this.loadUrl()},stop:function(){window.removeEventListener("popstate",this.checkUrl);window.removeEventListener("hashchange",this.checkUrl);P.started=false},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();if(t===this.fragment)return false;this.loadUrl()},loadUrl:function(t){t=this.fragment=this.getFragment(t);return this.handlers.some(function(e){if(e.route.test(t)){e.callback(t);return true}})},navigate:function(t,e){if(!P.started)return false;if(!e||e===true)e={trigger:!!e};var i=this.root+(t=this.getFragment(t||""));t=t.replace(F,"");if(this.fragment===t)return;this.fragment=t;if(t===""&&i!=="/")i=i.slice(0,-1);if(this._wantsPushState){this.history[e.replace?"replaceState":"pushState"]({},document.title,i)}else if(this._wantsHashChange){this._updateHash(this.location,t,e.replace)}else{return this.location.assign(i)}if(e.trigger)return this.loadUrl(t)},_updateHash:function(t,e,i){if(i){var r=t.href.replace(/(javascript:|#).*$/,"");t.replace(r+"#"+e)}else{t.hash="#"+e}}});["Model","Collection","Router","View","History"].forEach(function(t){var i=e[t];if(i)i.extend=e.extend});i.extend(e,m);if(P)e.history=new P;return e});